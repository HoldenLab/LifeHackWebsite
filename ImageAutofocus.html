<!DOCTYPE html>
<html>
<head>
  <title>LifeHack Microscope: ImLock Autofocus/Stabilisation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" type="text/css" href="main.css">

  <link rel="stylesheet" type="text/css" href="menu.css">

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B9XZF5GEV3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B9XZF5GEV3');
</script>

</head>

<body>

    <div id="myNav" class="overlay">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
      <div class="grid-container">
        <a href="home.html"><div class="hero-image-home">
          <div class="menu-text"><h1>Home</h1></div>
        </div></a>
        <a href="MainBody.html"><div class="hero-image-MainBody">
          <div class="menu-text"><h1>Main Body</h1></div>
        </div></a>
        <a href="BeamExpansion.html"><div class="hero-image-BeamExpansion">
          <div class="menu-text"><h1>Beam Expansion Module</h1></div>
        </div></a>
        <a href="Excitation.html"><div class="hero-image-Excitation">
          <div class="menu-text"><h1>Excitation Module</h1></div>
        </div></a>
        <a href="FocusShifter.html"><div class="hero-image-FocusShifter">
          <div class="menu-text"><h1>Focus Shifter</h1></div>
        </div></a>
        <a href="IncubationBox.html"><div class="hero-image-IncubationBox">
          <div class="menu-text"><h1>Incubation Box</h1></div>
        </div></a>
        <a href="https://github.com/HoldenLab/LifeHack"><div class="hero-image-github">
          <div class="menu-text"><h1>Git Hub</h1></div>
        </div></a>
       <a href="ImageAutofocus.html"><div class="hero-image-ImageAutofocus">
          <div class="menu-text"><h1>ImLock</h1></div>
        </div></a>
        <a href="Operation.html"><div class="hero-image-Operation">
          <div class="menu-text"><h1>Operation</h1></div>
        </div></a>
      </div>
    </div>
  <script>
  function openNav() {
    document.getElementById("myNav").style.height = "100%";
  }
  
  function closeNav() {
    document.getElementById("myNav").style.height = "0px";
  }
  </script>
  
  <div class="hero-image">
    <div class="hero-text">
      <h1>ImLock</h1>
      <p>Infra-Red Image Based Deep Autofocus and Live Drift Correction</p>
    </div>
  </div>

  <div class="nav-wrapper" style="height:80px;">
    <div id="navbar">
      <a href="javascript:void(0)" onclick="openNav()">&#9776; Menu</a>
    </div>
  </div>
  
  <div class="sidenav">
    <a href="#Description">Description</a>
    <a href="#Parts">Parts</a>
    <a href="#Construction">Construction</a>
    <a href="#Software">Software</a>
    <a href="https://github.com/HoldenLab/LifeHack/tree/master/Image%20Autofocus">Go to GitHub</a>
    <a href="https://github.com/HoldenLab/LifeHack/issues">Report Bug/Feedback</a>
    <hr> 
    <p>Project Contributors: Josh Edwards, Kevin Whitley, Sudeer Peneti, Yann Cesbron, Seamus Holden</p>
    <p>Website by Josh Edwards</p>
    <p>Updated: May 2021</p>
  </div>

  <div class="page">
    <video src="Video/ir-image-autofocus-animation.mp4" width="90%" controls autoplay muted></video>
  
    <h1 id="Description">Description</h1><hr>

    <p>This module provides the capability for infra-red brightfield imaging concurrently with visible band fluorescence. This hardware is combined with custom software to conduct image based, deep autofocus at up to 50 microns in depth. We have found this especially useful in imaging samples set in PDMS-microholes (used in Whitley et al bioRxiv 2020) where the cells themselves are held away from the cover surface.</p>

    <img src="Images/Image-Autofocus.jpg" width="60%">

    <h1 id="Parts">Parts</h1><hr>

    <iframe src="Parts-List/ImageAutofocus-Parts.htm" width="100%" height="500px" title="Parts"></iframe>

    <div class="minipage">
      <a class="button-design" href="Parts-List/ImageAutofocus-Parts.xlsx">&#8681; Download &#8681;</a>
      <a class="button-design" href="https://github.com/HoldenLab/LifeHack/tree/master/Image%20Autofocus/Parts">&#8681; Get Custom Part Designs &#8681;</a>
    </div>

    <h1 id="Construction">Construction</h1><hr>

    <a class="button-design" href="https://a360.co/3p8be5k" target="_blank">&#x1f441; View CAD Design Online &#x1f441;</a>
  
    <p>As this module has only one pathway and no degrees of freedom for adjustment it can be constructed and attached to the system simply following the designs. The combiner cube is the only part that needs alignment and this is detailed in the <a href="MainBody.html#Construction">Main Body</a> module.</p>

    <p>In principle this sytem can operate at a range of wavelengths. However, the suggested camera suffers from reduced sensitivity through the IR range. As such, poor performance has been observed when operating this system at 1050nm due to low SNR. To achieve a sufficient SNR whilst avoiding clashes with the CRISP system operating at 940nm we recomend operating with 850nm illumination.</p>

    <img src="Images/IMX250_sensitivity.jpg" width="40%">

    <h1 id="Software">Software</h1><hr>

    <p>This is a MicroManager hardware autofocus plugin developed between the Henriques and Holden laboratories. This plugin will perform microscopy autofocus and lateral drift correction using the cross correlated signal from infrared brightfield microscopy. It is based on the principle described in McGorty et al, Optical Nanoscopy 2013. As such, this software is not coupled to any particular hardware and may be used with cameras and stages other than those described here.</p>

    <a class="button-design" href="https://github.com/HoldenLab/DeepAutoFocus">&#x1f441; Get Software from GitHub &#x1f441;</a>

    <h2>Instructions</h2>

    <h3>Installation</h3>

    <p>From the folder "dist" in the GitHub repository, copy "DriftCorrectRH.jar" and the content of the "lib" folder into the Micromanager "plugins/micro-manager" directory. In the case of these files already existing in the target directory, the target directory files should be retained.</p>

    <p>The camera used for this module must be added to a MicroManager config file separate from the main system config file. Instructions are available <a href="https://micro-manager.org/wiki/Spinnaker">here</a> to install the required drivers for the Blackfly camera.</p>

    <p>The plugin may now be launched in MicroManager from "plugins/Beta/NanoJ Online Drift Correction". On opening, the <a href="https://github.com/HoldenLab/LifeHack/blob/master/Operation/BlackflyCamera.cfg">Config file</a> containing the camera's device adapter should be loaded using the "select configuration file" and "load hardware" buttons under the configuration tab.</p>

    <h3>Use</h3>

    <p>The plugin does not have the ability to trigger the illumination LED so this must be controlled manually. If using this as part of the LifeHack system this can be done through MicroManager.</p>
	
	  <img src="Images/DriftCorrect.jpg" width="100%">
	
	  <p>To use the plugin, First "get background image" to perform background subtraction. The stage will scan around the sample to record multiple fields of view for averaging.</p>
	  <p>Next "calibrate pixel size" to calculate the pixels-to-nm conversion factor. The stage will move laterally in user-defined steps and calculate the pixel displacements by cross-correlation.</p>
	  <p>"Start" takes a reference z-stack (if using XYZ or Z correction) or a single reference image (if using XY correction) and begins the drift correction protocol selected using the pulldown menu.</p>
	
	  <h3>Variables</h3>
	  <ul>
	    <li><b>Background subtraction step size:</b> Lateral move between background subtraction images. We find that a step size of 50 um works well.</li>
	    <li><b>Calibration step size:</b> Lateral move between images during the pixels-to-nm calibration routine. We find that a step size of 1-5 um works well.</li>
	    <li><b>Exposure time:</b> Exposure time of the camera, should be balanced to minimise LED power and motion blur.</li>
	    <li><b>Maximum ROI to analyse:</b> Sets the size of the area to perform cross-correlation on. The limits of this are camera-dependent. For the Blackfly camera used here the ROI cannot be reduced below 1200x1200 px.</li>
	    <li><b>Pixels to trim from edges:</b> Removes edge pixels from cross-correlation calculations.</li>
	    <li><b>Step size for Z correction:</b> Sets the depth between the images of the reference z-stack taken at the beginning of a run.</li>
	    <li><b>Alpha (scale for corrections):</b> User-defined scale factor for corrections along Z axis as described in McGorty et al. 2013 eq. 4. A value too small can result in slow corrections, although a value too large can result in overcorrections and 'ringing'. We recommend starting with a lower value like 1.5 and adjusting as necessary.</li>
	    <li><b>Time between corrections:</b> Sets the dwell time between stage corrections to avoid high frequency corrections to noise. Must be set greater than the set exposure time.</li>
	    <li><b>Maximum translation:</b> Limit on shift to prevent stage crashing.</li>
	  </ul>

  </div>

  <div class="bottomnav">
    <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">License: Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
    <a href="https://blogs.ncl.ac.uk/holdenlab/">Holden Lab Website</a>
  </div>

  <script>
    window.onscroll = function() {myFunction()};
    
    var navbar = document.getElementById("navbar");
    var sticky = navbar.offsetTop;
    
    function myFunction() {
      if (window.pageYOffset >= sticky) {
        navbar.classList.add("sticky")
      } else {
        navbar.classList.remove("sticky");
      }
    }
    </script>

  </body>
  </html>